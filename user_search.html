<!DOCTYPE html>
<html lang="ja" ng-app="concierAdminApp">
<head>
    <meta charset = "UTF-8">
    <title>絞込み検索</title>
    <script src = "https://ajax.googleapis.com/ajax/libs/angularjs/1.5.7/angular.min.js"></script>
    <script src = "userSearchController.js"></script>
    <link rel="stylesheet" type="text/css" href="user_search.css">
</head>
<body>
<div ng-controller="UserSearchCtrl">
<form>
<div>
    大学名:
    <div>
    <label>
        <input type="radio" ng-model="selected.univ" value="" name="univ_search">
            全て表示
    </label>
    <label ng-repeat="tag in userTag|filter: { category:'univ' }">
        <input type="radio" ng-model="selected.univ" value="{{tag.name}}" name="univ_search">
        <!-- <input type="radio" ng-model="user_univ" value="{{tag.name}}" name="univ_search"> -->
            {{tag.name}}
    </label>
    </div>
</div>
<div>
選択した大学：{{selected.univ}}
選択した大学ID：{{search.univ}}
</div>

<div>
    卒業年度:
    <div>
    <label>
      <input type="radio" ng-model="selected.grade" value="" name="grade_search">
        全て表示
    </label>
    <label ng-repeat="tag in userTag|filter: { category:'grade' }">
      <input type="radio" ng-model="selected.grade" value="{{tag.name}}" name="grade_search">
      <!-- <input type="radio" ng-model="user_univ" value="{{tag.name}}" name="univ_search"> -->
        {{tag.name}}
    </label>
    </div>
</div>
<div>
選択した大学：{{selected.grade}}
</div>

<div>
    専攻(文系):
    <div>
    <label>
      <input type="radio" ng-model="selected.major_art" value="" name="major_art_search">
        全て表示
    </label>
    <label ng-repeat="tag in userTag|filter: { category:'major_art' }">
      <input type="radio" ng-model="selected.major_art" value="{{tag.name}}" name="major_art_search">
      <!-- <input type="radio" ng-model="user_univ" value="{{tag.name}}" name="univ_search"> -->
        {{tag.name}}
    </label>
    </div>
</div>
<div>
選択した専攻：{{selected.major_art}}
</div>

<div>
    専攻(理系):
    <div>
    <label>
      <input type="radio" ng-model="selected.major_sci" value="" name="major_sci_search">
        全て表示
    </label>
    <label ng-repeat="tag in userTag|filter: { category:'major_sci' }">
      <input type="radio" ng-model="selected.major_sci" value="{{tag.name}}" name="major_sci_search">
      <!-- <input type="radio" ng-model="user_univ" value="{{tag.name}}" name="univ_search"> -->
        {{tag.name}}
    </label>
    </div>
</div>
<div>
選択した専攻：{{selected.major_sci}}
</div>

<div>
    志向:
    <div>
    <label>
      <input type="radio" ng-model="selected.preference" value="" name="preference_search">
        全て表示
    </label>
    <label ng-repeat="tag in userTag|filter: { category:'preference' }">
      <input type="radio" ng-model="selected.preference" value="{{tag.name}}" name="preference_search">
      <!-- <input type="radio" ng-model="user_univ" value="{{tag.name}}" name="univ_search"> -->
        {{tag.name}}
    </label>
    </div>
</div>
<div>
選択した志向：{{selected.preference}}
</div>

<div>
    志望業界:
    <div>
    <label>
      <input type="radio" ng-model="selected.industry" value="" name="industry_search">
        全て表示
    </label>
    <label ng-repeat="tag in userTag|filter: { category:'industry' }">
      <input type="radio" ng-model="selected.industry" value="{{tag.name}}" name="industry_search">
      <!-- <input type="radio" ng-model="user_univ" value="{{tag.name}}" name="univ_search"> -->
        {{tag.name}}
    </label>
    </div>
</div>
<div>
選択した志望業界：{{selected.industry}}
</div>

<div>
    性別:
    <div>
      <label>
        <input type="radio" selected="selected" ng-model="selected.sex" value="" name="sex_search">
          全て表示
      </label>
      <label>
        <input type="radio" ng-model="selected.sex" value="男" name="sex_search">
          男
      </label>
      <label>
        <input type="radio" ng-model="selected.sex" value="女" name="sex_search">
          女
      </label>
    </div>
</div>
<div>
選択した性別：{{selected.sex}}
選択した性別ID：{{search.sex}}
</div>

<div>
    <span>最小やりとり数：</span>
                    <select  ng-model="selected.loyalty" name="loyalty_search">
                        <option value="">以下から選択してください。</option>
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option selected="selected" value="3">3</option>
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option value="20">20</option>
                        <option value="50">50</option>
                    </select>
</div>
<div>
選択したやり取り数：{{selected.loyalty}}
</div>

<div>
    キーワード検索：<input type="text" ng-model="selected.keyword" name="keyword_search">
</div>
<div>
検索キーワード：{{selected.keyword}}
</div>

<button ng-click="doSearch()">
    検索
</button>
    
</form>
<p>
    <span >
        表示件数：{{(lineUserList| filter: filterByUniv| filter: filterByGrade| filter: filterByPreference| filter: filterByMajorArt| filter: filterByMajorSci| filter: filterByIndustry| filter: filterBySex| filter: filterByOperator| filter: filterByStatus| filter: filterByLoyalty| filter: search.keyword).length}}
    </span>
</p>



<ul class="list-group">
    <li class="list-group-item" ng-repeat="item in filteredList = (lineUserList| filter: filterByUniv| filter: filterByGrade| filter: filterByPreference| filter: filterByMajorArt| filter: filterByMajorSci| filter: filterByIndustry| filter: filterBySex| filter: filterByOperator| filter: filterByStatus| filter: filterByLoyalty| filter: search.keyword) track by $index">
        <div class="row" >
            <div class="col-sm-3 col-md-3">
                <a href="javascript:" ng-click="getUserMessages(item)">{{item.name}}</a>
            </div>
            <div class="col-sm-1 col-md-1">{{item.loyalty}}</div>
            <div ng-if="currentUser.id!=item.id">
                <div class="col-sm-6 col-md-6">
                    <span ng-repeat="tag in item.user_tag" class="tag-wrapper">
                        <a href="javascript:" ng-click="searchByTag(tag)">{{getTagName(tag)}}</a>
                    </span>
                </div>
                <div class="col-sm-1 col-md-1">
                    <a ng-click="openTagAddField(item)" href="javascript:">追加</a>
                </div>
                <div class="col-sm-1 col-md-1">
                    <a ng-click="openTagRemoveField(item)" href="javascript:">削除</a>
                </div>
            </div>

            <div ng-if="currentUser.id==item.id && tag_add">
                <div class="col-sm-4 col-md-4"><span ng-repeat="tag in item.user_tag" class="tag-wrapper">{{getTagName(tag)}}</span></div>
                <div class="col-sm-3 col-md-3 tag-edit-field">
                    <select name="selectedTag" ng-model="currentSelectedTag[currentUser.id]">
                        <option selected="selected" value="" disabled>---タグを選択---</option>
                        <option ng-repeat="tag in userTag" value="{{tag.id}}">{{tag.name}} / {{tag.categoryText}} </option>
                    </select>
                    <input type="text" class="tag-text" ng-model="currentTagText[currentUser.id]" placeholder="新規タグ">
                    <input type="submit" ng-click="addNewTag()"  value="追加" />
                </div>
                <div class="col-sm-1 col-md-1">
                    <a ng-click="openTagRemoveField(item)" href="javascript:">削除</a>
                </div>
            </div>

            <div ng-if="currentUser.id==item.id && !tag_add">
                <div class="col-sm-4 col-md-4">
                    <span ng-repeat="tag in item.user_tag" class="tag-wrapper">{{getTagName(tag)}}</span></div>
                    <div class="col-sm-1 col-md-1">
                        <a ng-click="openTagAddField(item)" href="javascript:">追加</a>
                    </div>
                    <div class="col-sm-3 col-md-3 tag-edit-field">
                        <select name="selectedTagToRemove" ng-model="currentTagToRemove[currentUser.id]">
                            <option selected="selected" value="" disabled>---タグを選択---</option>
                            <option ng-repeat="tag in item.user_tag" value="{{tag}}">{{getTagName(tag)}}</option>
                        </select>
                        <input type="submit" ng-click="removeTag()" value="削除" />
                    </div>
                </div>
        </div>
    </li>
</ul>

    <ul ng-repeat="user in users" class="pagination">
        <li><a href="#" ng-click="onpaging(0)">{{1}}</a></li>
    </ul>

</div>
</body>
